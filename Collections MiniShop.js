const wines = {
    molino_di_rovescala : {
        wine1 : {
            src: "https://cdn.shopify.com/s/files/1/0566/5285/7533/files/pinot_nero_rose.png?v=1682584227",
            text: "Pinot Nero Rosè",
            link: "https://www.tucciateliergastronomico.it/products/molino-di-rovescala-pinot-nero-rose"
        },
        wine2 : {
            src: "https://cdn.shopify.com/s/files/1/0566/5285/7533/files/pinot_nero_bianco.png?v=1682584226",
            text: "Pinot Nero Bianco",
            link: "https://www.tucciateliergastronomico.it/products/molino-di-rovescala-pinot-nero-vinificato-bianco"
        },
        wine3 : {
            src: "https://cdn.shopify.com/s/files/1/0566/5285/7533/files/bonarda.png?v=1682584225",
            text: "Bonarda fermo dell'Oltrepò Pavese 2022",
            link: "https://www.tucciateliergastronomico.it/products/molino-di-rovescala-bonarda-fermo-delloltrepo-pavese"
        },
        wine4 : {
            src: "https://cdn.shopify.com/s/files/1/0566/5285/7533/files/vigna_delle_olive.png?v=1682584228",
            text: "Riserva Vigna Delle Olive Di Levante 2021",
            link: "https://www.tucciateliergastronomico.it/products/molino-di-rovescala-risegna-vigna-delle-olive-di-levante"
        },
        wine5 : {
            src: "https://cdn.shopify.com/s/files/1/0566/5285/7533/files/vigna_del_felice.png?v=1682584226",
            text: "Riserva Vigna Del Felice 2021",
            link: "https://www.tucciateliergastronomico.it/products/molino-di-rovescala-riserva-vigna-del-felice-2021"
        },
        wine6 : {
            src: "https://cdn.shopify.com/s/files/1/0566/5285/7533/files/vigna_del_madone.png?v=1682584227",
            text: "Riserva Vigna Del Madone 2020",
            link: "https://www.tucciateliergastronomico.it/products/molino-di-rovescala-riserva-vigna-del-madone"
        },
        wine7 : {
            src: "https://cdn.shopify.com/s/files/1/0566/5285/7533/files/vigna_del_provomme.png?v=1682584227",
            text: "Riserva Vigna Del Povrömme 2020",
            link: "https://www.tucciateliergastronomico.it/products/molino-di-rovescala-vigna-del-povromme-2020"
        }
    },

    systers_run : {
        wine1 : {
            src: "https://cdn.shopify.com/s/files/1/0566/5285/7533/files/Calvary_Hill_2018.png?v=1682584174",
            text: "Sister's Run Cow's Corner 2019",
            link: "https://www.tucciateliergastronomico.it/products/sisters-run-cows-corner-2019"
        },
        wine2 : {
            src: "https://cdn.shopify.com/s/files/1/0566/5285/7533/files/Cow_s_Corner_2019.png?v=1682584174",
            text: "Sister's Run Calvary Hill 2018",
            link: "https://www.tucciateliergastronomico.it/products/sisters-run-calvary-hill-shiraz-2018"
        }
    },

    la_ceriola : {
        wine1 : {
            src: "https://cdn.shopify.com/s/files/1/0566/5285/7533/files/Spumante_Doc_Selezione_Oro.png?v=1682584129",
            text: "Colli Euganei Fior d'Arancio Spumante Doc - Selezione Oro 2018",
            link: "https://www.tucciateliergastronomico.it/products/la-ceriola-colli-euganei-fior-d-arancio-spumante-docg-selezione-oro"
        },
        wine2 : {
            src: "https://cdn.shopify.com/s/files/1/0566/5285/7533/files/Spumante_Doc_Extra_Dry_Selezione_Oro_2018.png?v=1682584129",
            text: "Prosecco Spumante Doc Extra Dry - Selezione Oro",
            link: "https://www.tucciateliergastronomico.it/products/la-ceriola-prosecco-spumante-doc-extra-dry-selezione-oro"
        }
    },

    heirloom_vineyards : {
        wine1 : {
            src: "https://cdn.shopify.com/s/files/1/0566/5285/7533/files/Coonawarra_2019.png?v=1682584091",
            text: "Coonawarra 2019",
            link: "https://www.tucciateliergastronomico.it/products/heirloom-vineyards-coonawarra-2019"
        },
        wine2 : {
            src: "https://cdn.shopify.com/s/files/1/0566/5285/7533/files/Adelaide_Hills_2020.png?v=1682584091",
            text: "Adelaide Hills 2020",
            link: "https://www.tucciateliergastronomico.it/products/heirloom-adelaide-hills"
        }
    },

    dandelion_vineyards : {
        wine1 : {
            src: "https://cdn.shopify.com/s/files/1/0566/5285/7533/files/Lionheart_of_the_Barossa_2018.png?v=1682583996",
            text: "Lionheart of the Barossa 2018",
            link: "https://www.tucciateliergastronomico.it/products/dandelion-vineyards-lionheart-of-the-barossa-2018"
        },
        wine2 : {
            src: "https://cdn.shopify.com/s/files/1/0566/5285/7533/files/Garden_of_the_Eden_Valley_2021.png?v=1682583996",
            text: "Enchanted Garden of the Eden Valley 2021",
            link: "https://www.tucciateliergastronomico.it/products/dandelion-vineyards-enchanted-garden-of-the-eden-valley-2021"
        },
        wine3 : {
            src: "https://cdn.shopify.com/s/files/1/0566/5285/7533/files/Managerie_of_the_Barossa_2019.png?v=1682583996",
            text: "Managerie of the Barossa 2019",
            link: "https://www.tucciateliergastronomico.it/products/dandelion-vineyards-managerie-of-the-barossa-2019"
        },
        wine4 : {
            src: "https://cdn.shopify.com/s/files/1/0566/5285/7533/files/Lion_s_Tooth_of_Mclaren_Vale_2019.png?v=1682583996",
            text: "Lion's Tooth of Mclaren Vale 2019",
            link: "https://www.tucciateliergastronomico.it/products/dandelion-vineyards-lions-tooth-of-mclaren-vale-shiraz-riesling-2019"
        },
        wine5 : {
            src: "https://cdn.shopify.com/s/files/1/0566/5285/7533/files/Fairytale_of_the_Barossa_Rose_2020.png?v=1682583995",
            text: "Fairytale of the Barossa Rosé 2020",
            link: "https://www.tucciateliergastronomico.it/products/dandelion-vineyards-fairytale-of-the-barossa-rosefairytale-of-the-barossa-grenache-rose-2020"
        }
    },

    cien_y_pico : {
        wine1 : {
            src: "https://cdn.shopify.com/s/files/1/0566/5285/7533/files/Doble_Pasta_2019.png?v=1682583949",
            text: "Doble Pasta 2019",
            link: "https://www.tucciateliergastronomico.it/products/cien-y-pico-doble-pasta-2019"
        },
        wine2 : {
            src: "https://cdn.shopify.com/s/files/1/0566/5285/7533/files/Vina_La_Ceja_2021.png?v=1682583948",
            text: "Viña La Ceja 2021",
            link: "https://www.tucciateliergastronomico.it/products/cien-y-pico-vina-la-ceja-2017"
        }
    },

    azienda_agricola_folini : {
        wine1 : {
            src: "https://cdn.shopify.com/s/files/1/0566/5285/7533/files/Dos_Bel_2017.png?v=1682583790",
            text: "Dos Bel 2017",
            link: "https://www.tucciateliergastronomico.it/products/dos-bel-2017"
        },
        wine2 : {
            src: "https://cdn.shopify.com/s/files/1/0566/5285/7533/files/L_Enrico_Riserva_2018.png?v=1682583790",
            text: "L'Enrico Riserva 2018",
            link: "https://www.tucciateliergastronomico.it/products/azienda-agricola-folini-lenrico-riserva-2018"
        }
    }



}

const collectionsrow = {
    row1: "CollectionsRow1",
    row2: "CollectionsRow2",
    row3: "CollectionsRow3"
}

const collectionidlist = {
    id1: "MiniWineShop1",
    id2: "MiniWineShop2",
    id3: "MiniWineShop3",
    id4: "MiniWineShop4",
    id5: "MiniWineShop5",
    id6: "MiniWineShop6",
    id7: "MiniWineShop7"
}

let collectionelementlist = [];

var device;

function GetElementById(id){
    return document.getElementById(id);
}

var lastcard;
let afterclick = false;
let wineslidenumber = 1;

/**
 * 
 * @param {HTMLDivElement} cardsender
 */
function InitializeMiniShop(cardsender){
    //CREATE "BACKUP" OF CARDS AND CHECK IF THE "BACKUP" IS EMPTY
    if (collectionelementlist.length == 0){
        for (let idnum = 1; idnum < Object.keys(collectionidlist).length + 1 ; idnum++){
            collectionelementlist.push(GetElementById(collectionidlist["id" + idnum]).parentElement);
        }
    } else {
        console.log(afterclick);
        if (cardsender != lastcard){
            ReInitializeCollections();
            InitializeMiniShop(cardsender);
        }
        afterclick = false;
        return;
    }

    //SETTING GLOBAL VARIABLE
    lastcard = cardsender;
    const shop_container = cardsender.children[0];
    const cardsender_number = shop_container.id.toString().at(-1);
    const current_wines_collection = Object.values(wines)[cardsender_number-1];
    const winecount = Object.keys(current_wines_collection).length;
    const column_row_number = Math.ceil(Math.sqrt(winecount));
    
    if (shop_container.children.length != 0){
        return;
    }

    const currentrow = cardsender.parentElement;
    const currentrownumber = currentrow.id.toString().at(-1);

    //REMOVE CARDS AFTER FIND ELEMENTS FOR THE SELECTED ONE
    for (let rownum = 1; rownum < Object.keys(collectionsrow).length+1; rownum++){
        const row = GetElementById(collectionsrow["row"+rownum]);
        for (let cardnum = 0; cardnum < 3 - (rownum%2); cardnum++){
            const _currentcard = row.children[0];
            if (_currentcard != cardsender && _currentcard != null){
                _currentcard.remove();
            } else {
                try{
                    row.children[1].remove();
                } catch {
                    continue;
                }
            }
        }
    }
    
    //COPY OF THE BACKUP
    let addaftercurrentcard = 0;
    let _collectionelementlist = [];
    for (i = 0; i < collectionelementlist.length; i++){
        _collectionelementlist[i] = collectionelementlist[i];
    }
    _collectionelementlist.splice(cardsender_number-1, 1);

    //REPLACE CARDS AFTER DELETE THEM
    for (let rownum = 0; rownum < Object.keys(collectionsrow).length; rownum++){
        const row = GetElementById(collectionsrow["row"+(rownum+1)]);
            if (row != currentrow){
            for (let cardnum = 0; cardnum < 3; cardnum++){
                /**
                 * @param {HTMLDivElement} _currentcard
                 */
                let _currentcard = _collectionelementlist[rownum*3 + cardnum + addaftercurrentcard];
                _currentcard.className = "collection-card-hover-other center-bottom-div";
                row.append(_currentcard);
            }
        } else {
            addaftercurrentcard -= 3;
        }
        
    }

    //DEFINE LENGHT AND HEIGHT OF WINES GRIDBOX
    var grid_template_text = "";
    for (var i = 0; i < Math.ceil(Math.sqrt(winecount)); i++){
        grid_template_text += Math.floor(100/Math.ceil(Math.sqrt(winecount)) - 3).toString() + "% ";
    }

    //SHOPCONTAINTER AND CONTENT - STYLE AND CLASS SETTING
    shop_container.className = "mini-wine-shop-inside-collection-hover";
    shop_container.style.padding = "0px";
    shop_container.parentElement.className = "collection-card-hover";
    shop_container.parentElement.children[1].className = "collection-card-image-hover";
    shop_container.parentElement.children[2].className = "collection-card-image-hover";
    
    //IMAGES AT THE LEFT OF THE COLLECTION
    const newimagecarddiv = document.createElement('img');
    newimagecarddiv.className = "new-image-collection-hover";
    newimagecarddiv.src = shop_container.parentElement.children[2].src;
    newimagecarddiv.onmouseover = function(){newimagecarddiv.style.cursor = "pointer";}
    newimagecarddiv.onmousedown = function(){window.open(wineries["winery" + cardsender_number].link, "_self");};
    //newimagecarddiv.onmousedown = function(){newimagecollectioncarddiv.firstChild.remove();};
    shop_container.appendChild(newimagecarddiv);

    //SCROLL PRODUCT TO THE LEFT
    if (winecount > 3){
        const scrolltoleftimg = document.createElement('img');
        scrolltoleftimg.style.display = "flex";
        scrolltoleftimg.src = "https://cdn.shopify.com/s/files/1/0566/5285/7533/files/angle-left.png?v=1682584779";
        scrolltoleftimg.style.width = "3%";
        scrolltoleftimg.style.height = "9%";
        scrolltoleftimg.onclick = function(){
            wineslidenumber -= 1;
            newimagecollectioncarddiv.lastChild.remove();
            if (wineslidenumber <= 0){
                wineslidenumber = winecount;
            }
            console.log(wineslidenumber);
            newimagecollectioncarddiv.insertBefore(SetWine(wineslidenumber), newimagecollectioncarddiv.firstChild);
        };
        shop_container.appendChild(scrolltoleftimg);
    }
    

    //WINES COLLECTIONS
    const newimagecollectioncarddiv = document.createElement('div');
    newimagecollectioncarddiv.className = "mini-wine-shop";
    newimagecollectioncarddiv.style.gridTemplateColumns = grid_template_text;
    newimagecollectioncarddiv.style.gridTemplateRows = "100%";
    newimagecollectioncarddiv.style.padding = "0px";
    newimagecollectioncarddiv.style.gap = "2%";
    shop_container.appendChild(newimagecollectioncarddiv);

    //SCROLL PRODUCT TO THE RIGHT
    if (winecount > 3){
        const scrolltorightimg = document.createElement('img');
        scrolltorightimg.style.display = "flex";
        scrolltorightimg.src = "https://cdn.shopify.com/s/files/1/0566/5285/7533/files/angle-right.png?v=1682584779";
        scrolltorightimg.style.width = "3%";
        scrolltorightimg.style.height = "9%";
        scrolltorightimg.onclick = function(){
            let delta = 2;
            wineslidenumber += 1;
            if (wineslidenumber > winecount - 2){
                delta = - winecount + 2;
            }

            if (wineslidenumber == winecount + 1){
                wineslidenumber = 1;
                delta = 2;
            }
            
            newimagecollectioncarddiv.firstChild.remove();
            newimagecollectioncarddiv.appendChild(SetWine(wineslidenumber+delta));
            
            if (wineslidenumber == winecount + 2){
                wineslidenumber = 1;
            }
    
            console.log(wineslidenumber);
            
        };
        shop_container.appendChild(scrolltorightimg);
    }
    

    //BACKGROUND GRAY DIV
    GetElementById("CloseColletionBackgroundDiv").style.display = "flex";
  
    //SET THE WINES IMAGES FOR THE CURRENT CARD
    function SetWine(wine){
        const div = document.createElement('div');
        div.className = "mini-shop-element-div";
        div.onmousedown = function(){window.open(current_wines_collection["wine" + wine].link, "_self")}

        const image = document.createElement('img');
        image.className = "wine-image-into-minishop";
        image.src = current_wines_collection["wine" + wine].src;
        newimagecollectioncarddiv.appendChild(image);
        
        const text = document.createElement('h3');
        text.className = "text-into-minishop";
        text.textContent = current_wines_collection["wine" + wine].text;
        newimagecollectioncarddiv.appendChild(text)

        div.appendChild(image);
        div.appendChild(text);
        return div;

    }

    for (let wine = 1; wine < winecount + 1; wine++){
        newimagecollectioncarddiv.appendChild(SetWine(wine));
        
        if (wine > 2){
            break;
        }
    }
}

/**
 * 
 * @param {HTMLDivElement} cardsender 
 */
function InitializePhoneMiniShop(cardsender){
    console.log(cardsender);
    if (cardsender.children[1].style.display == "none" || cardsender.children[1].style.display == ""){
        cardsender.children[1].style.display = "flex";
        cardsender.style.height = "180vw";
        cardsender.style.cursor = "default";
        cardsender.onmousedown = null;
        cardsender.children[0].onmousedown = function(){
            InitializePhoneMiniShop(cardsender);
        };
        cardsender.children[0].style.cursor = "pointer";

    } else {
        cardsender.children[1].style.display = "none";
        cardsender.style.height = "90vw";
        cardsender.style.cursor = "pointer";
    }


    cardsender.children[1].children[1].src =   Object.values(wines)[parseInt(cardsender.children[0].id.slice(-1))-1]["wine1"].src;
    
}

function ReInitializeCollections(){
    /**
     * @param {HTMLDivElement} card
     */
    //COPY OF THE BACKUP
    let _collectionelementlist = [];
    for (i = 0; i < collectionelementlist.length; i++){
        _collectionelementlist[i] = collectionelementlist[i];
    }

    //REMOVE BACKGROUND DIV
    GetElementById("CloseColletionBackgroundDiv").style.display = "none";
  
    //ROW'S LOOP
    for (let rownum = 0; rownum < Object.keys(collectionsrow).length; rownum++){
        const row = GetElementById(collectionsrow["row"+(rownum+1)]);
        if (rownum == 0){
            //row.parentElement.children[0].remove();
        }

        //PLACE 2 CARD
        if (rownum%2 == 0){
            for (let cardnum = 0; cardnum < 2; cardnum++){                
                row.append(_collectionelementlist[(rownum/2)*5+cardnum]);
                row.lastElementChild.className = "collection-card center-bottom-div";
                row.lastElementChild.children[0].textContent = "";
                row.lastElementChild.children[0].className = "mini-wine-shop-inside-collection";
                row.lastElementChild.children[1].className = "center-center-div";
                row.lastElementChild.children[2].className = "collection-card-image";                
            }

            //PLACE 3 CARD
        } else {
            for (let cardnum = 0; cardnum < 3; cardnum++){
                row.append(_collectionelementlist[((rownum-1)/2)*5+2+cardnum]);
                row.lastElementChild.className = "collection-card center-bottom-div";
                row.lastElementChild.children[0].textContent = "";
                row.lastElementChild.children[0].className = "mini-wine-shop-inside-collection";
                row.lastElementChild.children[1].className = "center-center-div";
                row.lastElementChild.children[2].className = "collection-card-image";
            }
        }
    }

    //CLEAR BACKUP
    collectionelementlist = [];
    wineslidenumber = 1;
}

let phonewinenumber = 1;
/**
 * 
 * @param {HTMLDivElement} sender 
 */
function ScrollphoneMinishop(sender){
    let delta = 0;
    let setslide = sender.className.split('-').slice(-1);
    let collectionnumber = parseInt(sender.parentElement.parentElement.children[0].id.slice(-1));
    if (setslide == "left"){
        delta = -1;
    } else { delta = 1; }
    
    if ( phonewinenumber + delta == 0 ){
        phonewinenumber = 7;
    } else if ( phonewinenumber + delta == 8 ){
        phonewinenumber = 1;
    } else {
        phonewinenumber += delta;
    }

    sender.parentElement.children[2].textContent = Object.values(wines)[collectionnumber - 1]["wine" + phonewinenumber].text;
    sender.parentElement.children[1].src = Object.values(wines)[collectionnumber - 1]["wine" + phonewinenumber].src;
    

}


window.addEventListener("resize", function(){
    if (this.window.matchMedia("(min-width: 500px)").matches && device != "computer"){
        console.log("computer");
        device = "computer";
        PlaceCardCollectionContent();
    } else if (this.window.matchMedia("(max-width: 499px)").matches && device != "phone"){
        console.log("phone");
        device = "phone";
        PlaceCardCollectionContent();
    }
})