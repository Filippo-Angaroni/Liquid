const wines = {
    molino_di_rovescala : {
        wine1 : {
            src: "Collections/Molino di Rovescala/pinot_nero_rose.png",
            text: "Pinot Nero Rosè",
            link: "https://www.tucciateliergastronomico.it/products/molino-di-rovescala-pinot-nero-rose"
        },
        wine2 : {
            src: "Collections/Molino di Rovescala/pinot_nero_bianco.png",
            text: "Pinot Nero Bianco",
            link: "https://www.tucciateliergastronomico.it/products/molino-di-rovescala-pinot-nero-vinificato-bianco"
        },
        wine3 : {
            src: "Collections/Molino di Rovescala/bonarda.png",
            text: "Bonarda fermo dell'Oltrepò Pavese 2022",
            link: "https://www.tucciateliergastronomico.it/products/molino-di-rovescala-bonarda-fermo-delloltrepo-pavese"
        },
        wine4 : {
            src: "Collections/Molino di Rovescala/vigna_delle_olive.png",
            text: "Riserva Vigna Delle Olive Di Levante 2021",
            link: "https://www.tucciateliergastronomico.it/products/molino-di-rovescala-risegna-vigna-delle-olive-di-levante"
        },
        wine5 : {
            src: "Collections/Molino di Rovescala/vigna_del_felice.png",
            text: "Riserva Vigna Del Felice 2021",
            link: "https://www.tucciateliergastronomico.it/products/molino-di-rovescala-riserva-vigna-del-felice-2021"
        },
        wine6 : {
            src: "Collections/Molino di Rovescala/vigna_del_madone.png",
            text: "Riserva Vigna Del Madone 2020",
            link: "https://www.tucciateliergastronomico.it/products/molino-di-rovescala-riserva-vigna-del-madone"
        },
        wine7 : {
            src: "Collections/Molino di Rovescala/vigna_del_provomme.png",
            text: "Molino di Rovescala - Riserva Vigna Del Povrömme 2020",
            link: "https://www.tucciateliergastronomico.it/products/molino-di-rovescala-vigna-del-povromme-2020"
        }
    },

    systers_run : {
        wine1 : {
            src: "Collections/Sister's Run/Calvary Hill 2018.png",
            text: "Sister's Run Cow's Corner 2019",
            link: "https://www.tucciateliergastronomico.it/products/sisters-run-cows-corner-2019"
        },
        wine2 : {
            src: "Collections/Sister's Run/Cow's Corner 2019.png",
            text: "Sister's Run Calvary Hill 2018",
            link: "https://www.tucciateliergastronomico.it/products/sisters-run-calvary-hill-shiraz-2018"
        }
    },

    la_ceriola : {
        wine1 : {
            src: "Collections/La Ceriola/Spumante Doc Selezione Oro.png",
            text: "Colli Euganei Fior d'Arancio Spumante Doc - Selezione Oro 2018",
            link: "https://www.tucciateliergastronomico.it/products/la-ceriola-colli-euganei-fior-d-arancio-spumante-docg-selezione-oro"
        },
        wine2 : {
            src: "Collections/La Ceriola/Spumante Doc Extra Dry Selezione Oro 2018.png",
            text: "Prosecco Spumante Doc Extra Dry - Selezione Oro",
            link: "https://www.tucciateliergastronomico.it/products/la-ceriola-prosecco-spumante-doc-extra-dry-selezione-oro"
        }
    },

    heirloom_vineyards : {
        wine1 : {
            src: "Collections/Heirloom Vineyards/Coonawarra 2019.png",
            text: "Coonawarra 2019",
            link: "https://www.tucciateliergastronomico.it/products/heirloom-vineyards-coonawarra-2019"
        },
        wine2 : {
            src: "Collections/Heirloom Vineyards/Adelaide Hills 2020.png",
            text: "Adelaide Hills 2020",
            link: "https://www.tucciateliergastronomico.it/products/heirloom-adelaide-hills"
        }
    },

    dandelion_vineyards : {
        wine1 : {
            src: "Collections/Dandelion Vineyards/Lionheart of the Barossa 2018.png",
            text: "Lionheart of the Barossa 2018",
            link: "https://www.tucciateliergastronomico.it/products/dandelion-vineyards-lionheart-of-the-barossa-2018"
        },
        wine2 : {
            src: "Collections/Dandelion Vineyards/Garden of the Eden Valley 2021.png",
            text: "Enchanted Garden of the Eden Valley 2021",
            link: "https://www.tucciateliergastronomico.it/products/dandelion-vineyards-enchanted-garden-of-the-eden-valley-2021"
        },
        wine3 : {
            src: "Collections/Dandelion Vineyards/Managerie of the Barossa 2019.png",
            text: "Managerie of the Barossa 2019",
            link: "https://www.tucciateliergastronomico.it/products/dandelion-vineyards-managerie-of-the-barossa-2019"
        },
        wine4 : {
            src: "Collections/Dandelion Vineyards/Lion's Tooth of Mclaren Vale 2019.png",
            text: "Lion's Tooth of Mclaren Vale 2019",
            link: "https://www.tucciateliergastronomico.it/products/dandelion-vineyards-lions-tooth-of-mclaren-vale-shiraz-riesling-2019"
        },
        wine5 : {
            src: "Collections/Dandelion Vineyards/Fairytale of the Barossa Rosé 2020.png",
            text: "Fairytale of the Barossa Rosé 2020",
            link: "https://www.tucciateliergastronomico.it/products/dandelion-vineyards-fairytale-of-the-barossa-rosefairytale-of-the-barossa-grenache-rose-2020"
        }
    },

    cien_y_pico : {
        wine1 : {
            src: "Collections/Cien Y Pico/Doble Pasta 2019.png",
            text: "Doble Pasta 2019",
            link: "https://www.tucciateliergastronomico.it/products/cien-y-pico-doble-pasta-2019"
        },
        wine2 : {
            src: "Collections/Cien Y Pico/Vina La Ceja 2021.png",
            text: "Viña La Ceja 2021",
            link: "https://www.tucciateliergastronomico.it/products/cien-y-pico-vina-la-ceja-2017"
        }
    },

    azienda_agricola_folini : {
        wine1 : {
            src: "Collections/Azienda Agricola Folini/Dos Bel 2017.png",
            text: "Dos Bel 2017",
            link: "https://www.tucciateliergastronomico.it/products/dos-bel-2017"
        },
        wine2 : {
            src: "Collections/Azienda Agricola Folini/L'Enrico Riserva 2018.png",
            text: "L'Enrico Riserva 2018",
            link: "https://www.tucciateliergastronomico.it/products/azienda-agricola-folini-lenrico-riserva-2018"
        }
    }



}

const collectionsrow = {
    row1: "CollectionsRow1",
    row2: "CollectionsRow2",
    row3: "CollectionsRow3"
}

const collectionidlist = {
    id1: "MiniWineShop1",
    id2: "MiniWineShop2",
    id3: "MiniWineShop3",
    id4: "MiniWineShop4",
    id5: "MiniWineShop5",
    id6: "MiniWineShop6",
    id7: "MiniWineShop7"
}

let collectionelementlist = [];

function GetElementById(id){
    return document.getElementById(id);
}

var lastcard;
let afterclick = false;

/**
 * 
 * @param {HTMLDivElement} cardsender
 */
function InitializeMiniShop(cardsender){
    //CREATE "BACKUP" OF CARDS AND CHECK IF THE "BACKUP" IS EMPTY
    if (collectionelementlist.length == 0){
        for (let idnum = 1; idnum < Object.keys(collectionidlist).length + 1 ; idnum++){
            collectionelementlist.push(GetElementById(collectionidlist["id" + idnum]).parentElement);
        }
    } else {
        console.log(afterclick);
        if (cardsender != lastcard){
            ReInitializeCollections();
            InitializeMiniShop(cardsender);
        }
        afterclick = false;
        return;
    }
    //SETTING GLOBAL VARIABLE
    lastcard = cardsender;
    const shop_container = cardsender.children[0];
    const cardsender_number = shop_container.id.toString().at(-1);
    const current_wines_collection = Object.values(wines)[cardsender_number-1];
    const winecount = Object.keys(current_wines_collection).length;
    const column_row_number = Math.ceil(Math.sqrt(winecount));
    
    if (shop_container.children.length != 0){
        return;
    }

    const currentrow = cardsender.parentElement;
    const currentrownumber = currentrow.id.toString().at(-1);

    //REMOVE CARDS AFTER FIND ELEMENTS FOR THE SELECTED ONE
    for (let rownum = 1; rownum < Object.keys(collectionsrow).length+1; rownum++){
        const row = GetElementById(collectionsrow["row"+rownum]);
        for (let cardnum = 0; cardnum < 3 - (rownum%2); cardnum++){
            const _currentcard = row.children[0];
            if (_currentcard != cardsender && _currentcard != null){
                _currentcard.remove();
            } else {
                try{
                    row.children[1].remove();
                } catch {
                    continue;
                }
            }
        }
    }
    
    //COPY OF THE BACKUP
    let addaftercurrentcard = 0;
    let _collectionelementlist = [];
    for (i = 0; i < collectionelementlist.length; i++){
        _collectionelementlist[i] = collectionelementlist[i];
    }
    _collectionelementlist.splice(cardsender_number-1, 1);

    //REPLACE CARDS AFTER DELETE THEM
    for (let rownum = 0; rownum < Object.keys(collectionsrow).length; rownum++){
        const row = GetElementById(collectionsrow["row"+(rownum+1)]);
            if (row != currentrow){
            for (let cardnum = 0; cardnum < 3; cardnum++){
                /**
                 * @param {HTMLDivElement} _currentcard
                 */
                let _currentcard = _collectionelementlist[rownum*3 + cardnum + addaftercurrentcard];
                _currentcard.className = "collection-card-hover-other center-bottom-div";
                row.append(_currentcard);
            }
        } else {
            addaftercurrentcard -= 3;
        }
        
    }

    //DEFINE LENGHT AND HEIGHT OF WINES GRIDBOX
    var grid_template_text = "";
    for (var i = 0; i < Math.ceil(Math.sqrt(winecount)); i++){
        grid_template_text += Math.floor(100/Math.ceil(Math.sqrt(winecount)) - 3).toString() + "% ";
    }

    //SHOPCONTAINTER AND CONTENT - STYLE AND CLASS SETTING
    shop_container.className = "mini-wine-shop-inside-collection-hover";
    shop_container.style.padding = "0px";
    shop_container.parentElement.className = "collection-card-hover";
    shop_container.parentElement.children[1].className = "collection-card-image-hover";
    shop_container.parentElement.children[2].className = "collection-card-image-hover";
    const newimagecarddiv = document.createElement('img');
    newimagecarddiv.className = "collection-card-image";
    newimagecarddiv.style.height = "100%";
    newimagecarddiv.style.width = "30%";
    newimagecarddiv.style.borderTopRightRadius = "0px";
    newimagecarddiv.style.borderBottomRightRadius = "0px";
    newimagecarddiv.style.borderTopLeftRadius = "1.5vw";
    newimagecarddiv.style.borderBottomLeftRadius = "1.5vw";
    newimagecarddiv.src = shop_container.parentElement.children[2].src;
    newimagecarddiv.onmouseover = function(){newimagecarddiv.style.cursor = "pointer";}
    newimagecarddiv.onmousedown = function(){window.open(wineries["winery" + cardsender_number].link);};
    shop_container.appendChild(newimagecarddiv);

    const newimagecollectioncarddiv = document.createElement('div');
    newimagecollectioncarddiv.className = "mini-wine-shop";
    shop_container.appendChild(newimagecollectioncarddiv);

    newimagecollectioncarddiv.style.gridTemplateColumns = grid_template_text;
    newimagecollectioncarddiv.style.gridTemplateRows = "100%";
    newimagecollectioncarddiv.style.padding = "0px";
    newimagecollectioncarddiv.style.gap = "2%";
    
    //BACKGROUND GRAY DIV
    const newdiv = document.createElement('div');
    newdiv.style.background = "rgba(50, 50, 50, .3)";
    newdiv.style.position = "absolute";
    newdiv.style.zIndex = "1";
    newdiv.style.height = "100%";
    newdiv.style.width = "100%";
    newdiv.style.filter = "blur(50px)";
    newdiv.onclick = function(){ReInitializeCollections()};
    shop_container.parentElement.parentElement.parentElement.insertBefore(newdiv, shop_container.parentElement.parentElement.parentElement.children[0]);
    
    //SET THE WINES IMAGES FOR THE CURRENT CARD
    for (let wine = 1; wine < winecount + 1; wine++){
        const div = document.createElement('div');
        div.className = "mini-shop-element-div";
        div.onmousedown = function(){window.open(current_wines_collection["wine" + wine].link)}

        const image = document.createElement('img');
        image.className = "image-into-minishop";
        image.src = current_wines_collection["wine" + wine].src;
        newimagecollectioncarddiv.appendChild(image);
        
        const text = document.createElement('h3');
        text.className = "text-into-minishop";
        text.textContent = current_wines_collection["wine" + wine].text;
        newimagecollectioncarddiv.appendChild(text)

        div.appendChild(image);
        div.appendChild(text);
        newimagecollectioncarddiv.appendChild(div);
        if (wine > 2){
            break;
        }
    }
    
}


function ReInitializeCollections(){
    /**
     * @param {HTMLDivElement} card
     */
    //COPY OF THE BACKUP
    let _collectionelementlist = [];
    for (i = 0; i < collectionelementlist.length; i++){
        _collectionelementlist[i] = collectionelementlist[i];
    }
    
    //ROW'S LOOP
    for (let rownum = 0; rownum < Object.keys(collectionsrow).length; rownum++){
        const row = GetElementById(collectionsrow["row"+(rownum+1)]);
        if (rownum == 0){
            row.parentElement.children[0].remove();
        }

        //PLACE 2 CARD
        if (rownum%2 == 0){
            for (let cardnum = 0; cardnum < 2; cardnum++){                
                row.append(_collectionelementlist[(rownum/2)*5+cardnum]);
                row.lastElementChild.className = "collection-card center-bottom-div";
                row.lastElementChild.children[0].textContent = "";
                row.lastElementChild.children[0].className = "mini-wine-shop-inside-collection";
                row.lastElementChild.children[1].className = "center-center-div";
                row.lastElementChild.children[2].className = "collection-card-image";                
            }

            //PLACE 3 CARD
        } else {
            for (let cardnum = 0; cardnum < 3; cardnum++){
                row.append(_collectionelementlist[((rownum-1)/2)*5+2+cardnum]);
                row.lastElementChild.className = "collection-card center-bottom-div";
                row.lastElementChild.children[0].textContent = "";
                row.lastElementChild.children[0].className = "mini-wine-shop-inside-collection";
                row.lastElementChild.children[1].className = "center-center-div";
                row.lastElementChild.children[2].className = "collection-card-image";
            }
        }
    }

    //CLEAR BACKUP
    collectionelementlist = [];
}